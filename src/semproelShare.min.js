/* semproelShare : A Pure Javascript Share Plugin. MIT - Copyright (c) 2016 Atok Fakhrudin */
!function(e,r){"use strict";e.semproelShare=r(e)}(window,function(e){"use strict";function r(e){var r=[],t=e.platformKitchen,o=e.perPlatformCount;return e.sharePlatform.forEach(function(e,n){r[n]=f(t[e].urlCountGetter).then(t[e].success.bind(o),function(r){return console.log(Error(s+'"Fetching '+e+" count error! Reason: "+r+'"')),0})}),r}function t(e,r){switch(e.length){case 4:r.innerHTML=e.slice(0,1)+"."+e.slice(1,2)+"k";break;case 5:r.innerHTML=e.slice(0,2)+"."+e.slice(2,3)+"k";break;case 6:r.innerHTML=e.slice(0,3)+"k";break;case 7:r.innerHTML=e.slice(0,1)+"."+e.slice(1,2)+"m";break;case 8:r.innerHTML=e.slice(0,2)+"."+e.slice(2,3)+"m";break;case 9:r.innerHTML=e.slice(0,3)+"m";break;case 10:r.innerHTML=e.slice(0,1)+"."+e.slice(1,2)+"g";break;default:r.innerHTML=e}}function o(e){var r;e.preventDefault(),r=e.target,r.hasAttribute(i)?m(r.getAttribute(i),c):r.parentNode.hasAttribute(i)&&m(r.parentNode.getAttribute(i),c),e.stopPropagation()}function n(f){function m(){Promise.all(r({platformKitchen:c,sharePlatform:f.sharePlatform,perPlatformCount:h})).then(function(r){a=r.reduce(function(e,r){return e+r}),t(""+a,f.shareCount),e.removeEventListener("load",m)})["catch"](function(r){throw e.removeEventListener("load",m),Error(s+r)})}if(arguments.length<1)throw Error(s+'"You are missing a parameter. Please check the documentation."');for(var d=["share","shareCount","sharePlatform","shareButtonContainer"],p=d.length;p--;)if(void 0===f[d[p]]||"string"!=typeof f[d[p]])throw Error(s+'"You are either missing required one object key (among these: "share", "shareCount", "sharePlatform", "shareButtonContainer") in your parameter or giving it a wrong type (while it must be a string). Please refer to the documentation."');if(!/^data-(?:[a-z]+-?)*(?:[a-z]+$)/.test(f.sharePlatform))throw Error("Your 'data-*' attribute for sharePlatform object key must follow this pattern (using all lowercase letters with no numbers): data-younamethis-or-and-with-this");var g=u;if(f.pageUrl=f.pageUrl||g.URL,f.pageTitle=f.pageTitle||g.title,f.pageDescription=f.pageDescription||g.head.querySelector("[name=description]").content||"",f.pageMedia=f.pageMedia||"",f.share=g.querySelector(f.share),f.shareCount=f.share.querySelector(f.shareCount),i=f.sharePlatform,f.sharePlatform=function(r){for(var t,o=r.share.querySelectorAll("["+r.sharePlatform+"]"),a=o.length,l=[],u=e,h=c;a--;){if(l[a]=o[a].getAttribute(r.sharePlatform),void 0===n.mediaPlatform[l[a]]||"function"!=typeof n.mediaPlatform[l[a]])throw Error(s+'One of your hook at "semproelShare.mediaPlatform.yourSocialMediaHook" is not available among values of "'+i+'". They should not duplicate (only one at hook and only one becomes the value of '+i+') and should correlate equally (i.e. be the same). For instance if at semproelShare.mediaPlatform hook is "semproelShare.mediaPlatform.facebook", then at '+i+' should look like "'+i+"='facebook'\".");t=u.encodeURI(r.pageUrl),h[l[a]]=new n.mediaPlatform[l[a]],h[l[a]].urlSharer=h[l[a]].urlSharer.replace("{{url}}",t).replace("{{title}}",u.encodeURIComponent(r.pageTitle)).replace("{{description}}",u.encodeURIComponent(r.pageDescription)).replace("{{media}}",u.encodeURI(r.pageMedia)),h[l[a]].urlCountGetter+=t+"&callback="}return l}(f),f.shareButtonContainer=f.share.querySelector(f.shareButtonContainer),null===f.share||null===f.shareCount||0===f.sharePlatform.length||null===f.shareButtonContainer)throw Error(s+'"Your CSS selector for one of these parameter {param.share, param.shareCount, param.sharePlatform, param.shareButtonContainer} does not match."');l=f.shareCount,e.addEventListener("load",m),f.shareButtonContainer.addEventListener("click",o,!1)}var a,i,l,s="semproelShare(): ",u=document,c={},h={},f=function(e,r,t){function o(e,t){var o=r.createElement("script");return o.async=!0,o.src=e+t,o}return function(r){return new Promise(function(n,a){var i="kolbek"+Math.round(1e5*Math.random()),l=o(r,i);e[i]=function(e){n(e)},l.onerror=function(){a("Network error! Either you lost connection to the server before the data is received or error was occuring in the origin server of "+r),e[i]=null,delete e[i],t.removeChild(l),l=null},l.onload=function(){e[i]=null,delete e[i],t.removeChild(l),l=null},t.appendChild(l)})}}(e,u,u.body),m=function(e,r){function o(t){var o=e.screenX||e.screenLeft,n=e.screenY||e.screenTop,a=e.innerWidth||r.documentElement.clientWidth||r.body.clientWidth,i=e.innerHeight||r.documentElement.clientHeight||r.body.clientHeight,l=a/2-t.popupWidth/2+o,s=i/2-t.popupHeight/2+n,u=e.open(t.url,t.title,"width="+t.popupWidth+",height="+t.popupHeight+",top="+s+",left="+l+",titlebar=yes,toolbar=no,menubar=no,location=yes,resizable=no,scrollbars=yes,status=yes");return e.focus&&u.focus(),u}return function(r,n){var i,u=o({url:n[r].urlSharer,title:"Share on "+r,popupWidth:750,popupHeight:450}),c=h[r];i=e.setInterval(function(){u.closed===!0&&(e.clearInterval(i),e.setTimeout(function(){f(n[r].urlCountGetter).then(n[r].success.bind(h)).then(function(e){console.log("Success fetching individual count exec"),a=a-c+e,t(""+a,l)},function(e){throw Error(s+'"Fetching '+r+" count error! Reason: "+e+'"')})},n[r].wait||0))},250)}}(e,u);return n.mediaPlatform={},n});
